# Wallet Service

REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–º–∏ –∫–æ—à–µ–ª—å–∫–∞–º–∏ –∏ –¥–µ–Ω–µ–∂–Ω—ã–º–∏ –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –°–æ–∑–¥–∞–Ω–∏–µ —Å—á–µ—Ç–æ–≤ –∏ –ø–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞
- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ —Å–Ω—è—Ç–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
- –î–µ–Ω–µ–∂–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏ (–ø–æ ID –∏–ª–∏ –∏–º–µ–Ω–∞–º)
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –ø–µ—Ä–µ–≤–æ–¥ (–∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π)
- **–ö–æ–º–∏—Å—Å–∏—è 1%** –∑–∞ –ø–µ—Ä–µ–≤–æ–¥—ã (–º–∏–Ω. 0.01)
- **–õ–∏–º–∏—Ç—ã:** –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –ø–µ—Ä–µ–≤–æ–¥—ã 500,000 –≤ –¥–µ–Ω—å
- **–û—Ç–º–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** (–≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—á–µ—Ç—É (–æ–±–æ—Ä–æ—Ç—ã, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π)
- –ó–∞—â–∏—Ç–∞ –æ—Ç race conditions –∏ deadlock –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ H2 (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞) –∏ PostgreSQL (–ø—Ä–æ–¥–∞–∫—à–µ–Ω)

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Java 17+
- Gradle 7+

## üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã –¥–≤–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:

### Swagger UI - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
http://localhost:8080/swagger-ui/index.html

**–î–ª—è —á–µ–≥–æ:** –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API. –ü–æ–∑–≤–æ–ª—è–µ—Ç:
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ endpoints
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞
- –í–∏–¥–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤

### H2 Console - –ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
http://localhost:8080/h2-console

**–î–ª—è —á–µ–≥–æ:** –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö. –ü–æ–∑–≤–æ–ª—è–µ—Ç:
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –∏ –¥–∞–Ω–Ω—ã–µ
- –í—ã–ø–æ–ª–Ω—è—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
- JDBC URL: `jdbc:h2:file:./data/walletdb;AUTO_SERVER=TRUE`
- Username: `admin`
- Password: (–æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º)

## üìö API

### –°—á–µ—Ç–∞

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| POST | `/accounts` | –°–æ–∑–¥–∞—Ç—å —Å—á—ë—Ç |
| GET | `/accounts` | –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—á–µ—Ç–æ–≤ |
| GET | `/accounts/{id}` | –ü–æ–ª—É—á–∏—Ç—å —Å—á—ë—Ç –ø–æ ID |
| GET | `/accounts/by-name/{ownerName}` | –ü–æ–ª—É—á–∏—Ç—å —Å—á—ë—Ç –ø–æ –∏–º–µ–Ω–∏ –∏ –≤–∞–ª—é—Ç–µ |
| GET | `/accounts/{id}/balance` | –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å |
| GET | `/accounts/{id}/stats` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–æ–±–æ—Ä–æ—Ç—ã, –∫–æ–ª-–≤–æ –ø–µ—Ä–µ–≤–æ–¥–æ–≤) |
| POST | `/accounts/{id}/deposit` | –ü–æ–ø–æ–ª–Ω–∏—Ç—å —Å—á—ë—Ç (ID) |
| POST | `/accounts/by-name/{name}/deposit` | –ü–æ–ø–æ–ª–Ω–∏—Ç—å —Å—á—ë—Ç (–ò–º—è) |
| POST | `/accounts/{id}/withdraw` | –°–Ω—è—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ |
| DELETE | `/accounts/{id}` | –£–¥–∞–ª–∏—Ç—å —Å—á—ë—Ç (—Ç–æ–ª—å–∫–æ —Å –Ω—É–ª–µ–≤—ã–º –±–∞–ª–∞–Ω—Å–æ–º) |

### –ü–µ—Ä–µ–≤–æ–¥—ã

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| POST | `/transfers` | –ü–µ—Ä–µ–≤–æ–¥ –ø–æ ID —Å—á–µ—Ç–æ–≤ |
| POST | `/transfers/by-names` | –ü–µ—Ä–µ–≤–æ–¥ –ø–æ –∏–º–µ–Ω–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ |
| POST | `/transfers/{id}/cancel` | –û—Ç–º–µ–Ω–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ (–≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω) |
| GET | `/transfers/{id}` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–µ—Ä–µ–≤–æ–¥–µ |
| GET | `/transfers/count` | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤ |

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

**–°–æ–∑–¥–∞—Ç—å —Å—á—ë—Ç:**
```json
POST /accounts
{
  "ownerName": "John Doe",
  "currency": "USD"
}
```

**–ü–µ—Ä–µ–≤–æ–¥ (—Å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é):**
> –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –ø–æ–ª–µ `idempotencyKey` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å —Ç–µ–º –∂–µ –∫–ª—é—á–æ–º –≤–µ—Ä–Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏, –Ω–µ —Å–ø–∏—Å—ã–≤–∞—è –¥–µ–Ω—å–≥–∏ –¥–≤–∞–∂–¥—ã.

```json
POST /transfers
{
  "idempotencyKey": "550e8400-e29b-41d4-a716-446655440000",
  "fromAccountId": "uuid-from",
  "toAccountId": "uuid-to",
  "amount": 100.00
}
```

**–°–Ω—è—Ç–∏–µ —Å—Ä–µ–¥—Å—Ç–≤:**
```json
POST /accounts/{id}/withdraw
{
  "amount": 50.00
}
```

## üîí –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** –í—Å–µ –ø–µ—Ä–µ–≤–æ–¥—ã —Ç—Ä–µ–±—É—é—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π UUID `idempotencyKey`.
- **–ö–æ–º–∏—Å—Å–∏—è:** –° –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ + 1% –∫–æ–º–∏—Å—Å–∏–∏ (–º–∏–Ω–∏–º—É–º 0.01).
- **–õ–∏–º–∏—Ç—ã:** –°—É–º–º–∞ –∏—Å—Ö–æ–¥—è—â–∏—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 500,000 –µ–¥–∏–Ω–∏—Ü –≤–∞–ª—é—Ç—ã –≤ —Å—É—Ç–∫–∏.
- **–û—Ç–º–µ–Ω–∞:** –ú–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥, –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ –º–µ–Ω–µ–µ 5 –º–∏–Ω—É—Ç –∏ —É –ø–æ–ª—É—á–∞—Ç–µ–ª—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞.
- **–£–¥–∞–ª–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —Å—á–µ—Ç —Å –Ω—É–ª–µ–≤—ã–º –±–∞–ª–∞–Ω—Å–æ–º.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- **–ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (`PESSIMISTIC_WRITE`)** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç race conditions –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞.
- **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫** (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ ID –∏–ª–∏ –∏–º–µ–Ω–∞–º) –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –≤–∑–∞–∏–º–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (deadlock).
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å** (`@Transactional`) –≤—Å–µ—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.
- **–í–∞–ª–∏–¥–∞—Ü–∏—è** –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö (—Ñ–æ—Ä–º–∞—Ç –≤–∞–ª—é—Ç—ã, –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Å—É–º–º—ã, —Ç–æ—á–Ω–æ—Å—Ç—å –¥–æ 2 –∑–Ω–∞–∫–æ–≤).